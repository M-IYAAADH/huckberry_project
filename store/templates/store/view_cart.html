{% extends "base.html" %}
{% load static %}

{% block title %}Your Cart - Huckberry{% endblock %}

{% block content %}
<h2 class="page-title">Your Cart</h2>

{% if cart_items %}
<div class="table-container">
  <table class="cart-table">
    <thead>
      <tr>
        <th>Product</th>
        <th>Price</th>
        <th>Quantity</th>
        <th>Subtotal</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% for item in cart_items %}
      <tr>
        <td>
          <div class="cart-product-info">
            {% if item.product.image %}
            <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}">
            {% endif %}
            <div class="cart-product-details">
              <h4>{{ item.product.name }}</h4>
              <p>{{ item.product.get_brand_display }}</p>
            </div>
          </div>
        </td>
        <td>MVR {{ item.product.price|floatformat:2 }}</td>
        <td>
          <form method="post" action="{% url 'update_cart_item' item.id %}">
            {% csrf_token %}
            <div class="quantity-controls">
              <button type="submit" name="decrement">âˆ’</button>
              <input type="number" name="quantity" value="{{ item.quantity }}" min="1" readonly>
              <button type="submit" name="increment">+</button>
            </div>
          </form>
        </td>
        <td>MVR {{ item.subtotal|floatformat:2 }}</td>
        <td>
          <form method="post" action="{% url 'remove_cart_item' item.id %}" style="display:inline;">
            {% csrf_token %}
            <button type="submit" class="remove-item" title="Remove item">&times;</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Cart Totals -->
<div class="totals-panel">
  <h3>Cart Summary</h3>
  <ul class="totals-list">
    <li>
      <span>Subtotal</span>
      <span>MVR {{ total|floatformat:2 }}</span>
    </li>
    <li>
      <span>Shipping</span>
      <span>Free</span>
    </li>
    <li>
      <span>Tax</span>
      <span>MVR 0.00</span>
    </li>
  </ul>
  <div class="totals-total">
    <span>Total</span>
    <span>MVR {{ total|floatformat:2 }}</span>
  </div>

  <div class="cart-actions" style="margin-top: 1.5rem; justify-content: center;">
    <a href="{% url 'product_list' %}" class="button-outline">Continue Shopping</a>
    <a href="{% url 'checkout' %}" class="button">Proceed to Checkout</a>
  </div>
</div>

{% else %}
<!-- Empty Cart -->
<div class="empty-cart">
  <div style="font-size: 64px; margin-bottom: 1rem;">ðŸ›’</div>
  <h2>Your cart is empty</h2>
  <p>Looks like you haven't added any sunglasses yet.</p>
  <a href="{% url 'product_list' %}" class="button">Shop Sunglasses</a>
</div>
{% endif %}

{% endblock %}